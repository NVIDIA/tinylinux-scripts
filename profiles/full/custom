# Install additional packages
install_config /conf.d boot

install_package dev-libs/openssl
ROOT="$NEWROOT" emerge --unmerge -q debianutils

install_package expat
install_package =python-${PYTHON_VER}* "" "--nodeps"
rm -rf "$NEWROOT"/usr/lib*/python*/test
install_package dev-lang/python-exec
ROOT="$NEWROOT" eselect python set python${PYTHON_VER}

USE=ithreads emerge --quiet --usepkg --buildpkg perl # Enable ithreads
install_package perl-cleaner "" "--nodeps" # PERL pulls this, and this in turn pulls too much
perl-cleaner -q --all -- -q
ignore_busybox_symlinks /bin/bzip2 /bin/bunzip2 /bin/bzcat
install_package perl "ithreads"
ROOT="$NEWROOT" SYSROOT="$NEWROOT" eselect news read # Print news items from PERL
install_package iasl
install_package pmtools
install_package sys-devel/gdb "client server"
install_package dev-util/strace "aio"
install_package vim-core minimal
install_package vim minimal --nodeps
sed -i '/skip_defaults_vim/s/^/"/' "$NEWROOT"/etc/vim/vimrc
install_package alsa-utils "ncurses libsamplerate"
remove_gentoo_services alsasound
install_package vbetool
install_package net-nds/ypbind
install_package net-fs/autofs "" "--nodeps"
yes | ROOT=/newroot etc-update --automode -7 # Clean up autofs script changes
install_package ipmitool "openipmi python"
install_package ipmiutil
install_package dmidecode
install_package sys-apps/i2c-tools "python"
install_package app-arch/zstd # curl dependency (missing in curl ebuild)
install_package net-misc/curl
install_package rsync
install_package sys-apps/lm-sensors
install_package smartmontools
install_package p7zip
install_package zip
install_package app-misc/screen
install_package acpid
yes | ROOT=/newroot etc-update --automode -7 # Clean up acpid script changes
install_package app-admin/sudo
install_package sys-apps/file "python zlib"
install_package app-arch/xz-utils # Needed by lzma module in Python
install_package sys-block/parted "" --nodeps
cp -a /lib64/lib{uuid,blkid}.so.* "$NEWROOT"/lib64/ # Needed by parted, but we don't want entire util-linux
install_package media-tv/v4l-utils "jpeg"

# Python modules
install_package dev-python/cffi
install_package dev-python/dnspython
rm -rf "$NEWROOT"/usr/lib*/python*/site-packages/Crypto/SelfTest
install_package dev-python/pip
mkdir -p /etc/portage/package.accept_keywords
echo "=dev-python/pyocr-0.8 **" >> /etc/portage/package.accept_keywords/full
install_package app-arch/libarchive
install_package dev-python/pyocr "tesseract"

# PERL modules
mkdir -p /etc/portage/package.accept_keywords
echo "perl-core/Thread-Semaphore **" >> /etc/portage/package.accept_keywords/full
echo "perl-core/Time-HiRes **"       >> /etc/portage/package.accept_keywords/full
install_package dev-perl/JSON
install_package dev-perl/Getopt-Long-Descriptive
install_package perl-core/Thread-Semaphore
install_package perl-core/Time-HiRes
install_package dev-perl/Text-Iconv
install_package dev-perl/Spreadsheet-ParseExcel
install_package dev-perl/Archive-Zip
install_package dev-perl/Net-SNMP
install_package perl-cleaner "" "--unmerge"

# Tidy up
remove_gentoo_services pydoc-2.7 pydoc-${PYTHON_VER} ipmievd fancontrol lm_sensors rsyncd
remove_gentoo_services opentmpfiles-dev opentmpfiles-setup
