# Install additional packages
install_into tiny/conf boot
install_package dev-libs/openssl

install_package expat
install_package =python-2.7* "" "--nodeps"
install_package =python-3.6* "" "--nodeps"
rm -rf "$NEWROOT"/usr/lib64/python*/test
install_package dev-lang/python-exec
ROOT="$NEWROOT" eselect python set python2.7

USE=ithreads emerge --quiet --usepkg --buildpkg perl # Enable ithreads
install_package perl-cleaner "" "--nodeps" # PERL pulls this, and this in turn pulls too much
perl-cleaner -q --all -- -q
ignore_busybox_symlinks /bin/bzip2 /bin/bunzip2 /bin/bzcat
install_package perl "ithreads"
install_package iasl
install_package pmtools
install_package sys-devel/gdb "client server"
install_package dev-util/strace "aio"
install_package vim-core minimal
install_package vim minimal --nodeps
sed -i '/skip_defaults_vim/s/^/"/' "$NEWROOT"/etc/vim/vimrc
install_package alsa-utils "ncurses libsamplerate"
remove_gentoo_services alsasound
install_package vbetool
install_package net-nds/ypbind
install_package net-fs/autofs "" "--nodeps"
install_package ipmitool "openipmi python"
install_package ipmiutil
install_package dmidecode
install_package net-misc/curl
install_package rsync
install_package lm_sensors
install_package smartmontools
install_package p7zip
install_package zip
install_package app-misc/screen
install_package acpid

# Python modules
install_package dev-python/aniso8601
install_package dev-python/asn1crypto
install_package dev-python/Babel
install_package dev-python/cffi
install_package dev-python/chardet
install_package dev-python/click
install_package dev-python/flask
install_package dev-python/flask-babel
install_package dev-python/flask-restful
install_package dev-python/futures
install_package dev-python/idna
install_package dev-python/pip
install_package dev-python/pyopenssl
install_package dev-python/PySocks
install_package dev-python/requests
install_package dev-python/ruamel-yaml

# PERL modules
mkdir -p /etc/portage/package.unmask
echo "perl-core/Thread-Semaphore **" >> /etc/portage/package.keywords/full
echo "perl-core/Time-HiRes **"       >> /etc/portage/package.keywords/full
install_package dev-perl/JSON
install_package dev-perl/Getopt-Long-Descriptive
install_package perl-core/File-Path
install_package perl-core/Thread-Semaphore
install_package perl-core/Time-HiRes
install_package dev-perl/Text-Iconv
install_package dev-perl/Spreadsheet-ParseExcel
install_package dev-perl/Archive-Zip
install_package dev-perl/Net-SNMP
install_package perl-cleaner "" "--unmerge"

# Tidy up
remove_gentoo_services pydoc-2.7 pydoc-3.6 ipmievd fancontrol lm_sensors rsyncd
[[ -f "$NEWROOT/usr/bin/python-wrapper" ]] || (
    cd "$NEWROOT/usr/bin"
    ln -s python2 python-wrapper
)
