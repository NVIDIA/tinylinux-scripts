# Override tiny directory for the server to avoid clashes with client directory
TINYDIR="tinysrv"

# Install ipsvd
install_package ipsvd "" "--usepkg --buildpkg"

# Install additional config files
install_into tiny udhcpd.conf
install_into tiny/conf.d boot net tftpd

# Install NFS exports
install_into /etc exports

# Install PXE configuration
[ -d "$INSTALL/client/pxelinux.cfg" ] || mkdir -p "$INSTALL/client/pxelinux.cfg" || exit $?
cp /usr/share/syslinux/pxelinux.0 "$INSTALL/client"/ || exit $?
echo "default tiny/kernel initrd=tiny/initrd nfsshare=10.0.0.1:/mnt/nv/client" > "$INSTALL/client/pxelinux.cfg/default" || exit $?

# Install libblkid/libuuid required by nfs-utils
cp -d /lib/libblkid.so* /lib/libuuid.so* "$NEWROOT/lib"/ || exit $?

# Remove MODS directory
[ -d "$INSTALL/mods" ] && rm -rf "$INSTALL/mods"
